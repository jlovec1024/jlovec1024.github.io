<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="kube-apiserver审计日志记录和采集, Jlovec"><meta name="description" content="Kubernetes 审计功能提供了与安全相关的按时间顺序排列的记录集，记录单个用户、管理员或系统其他组件影响系统的活动顺序。它能帮助集群管理员处理以下问题：

发生了什么？
什么时候发生的？
谁触发的？
为什么发生？
在哪观察到的？
它从"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="referrer" content="no-referrer"><title>kube-apiserver审计日志记录和采集 | Jlovec</title><link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/awesome/css/all.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/materialize/materialize.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/aos/aos.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/animate/animate.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/css/matery.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/css/my.css"><script src="/libs/jquery/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/jquery/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.2"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="Jlovec" type="application/atom+xml"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><img src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">Jlovec</span></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/articles" class="waves-effect waves-light"><i class="fa fa-bars" style="zoom:.6"></i> <span>文章</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/tags"><i class="fas fa-tags" style="margin-top:-20px;zoom:.6"></i> <span>标签</span></a></li><li><a href="/categories"><i class="fas fa-bookmark" style="margin-top:-20px;zoom:.6"></i> <span>分类</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span> <i class="fas fa-chevron-down" aria-hidden="true" style="zoom:.6"></i></a><ul class="sub-nav menus_item_child"><li><a href="/archives"><i class="fa fa-tasks" style="margin-top:-20px;zoom:.6"></i> <span>简约风</span></a></li><li><a href="/timeline"><i class="fa fa-ellipsis-v" style="margin-top:-20px;zoom:.6"></i> <span>时间轴</span></a></li></ul></li><li class="hide-on-med-and-down nav-item"><a href="/data" class="waves-effect waves-light"><i class="fa fa-list-alt" style="zoom:.6"></i> <span>统计</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">Jlovec</div><div class="logo-desc">Never really desperate, only the lost of the soul.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fa fa-bars"></i> 文章 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/tags" style="margin-left:75px" ;><i class="fa fas fa-tags" style="position:absolute;left:50px"></i> <span>标签</span></a></li><li><a href="/categories" style="margin-left:75px" ;><i class="fa fas fa-bookmark" style="position:absolute;left:50px"></i> <span>分类</span></a></li></ul></li><li class="m-nav-item"><a href="javascript:;"><i class="fa-fw fas fa-archive"></i> 归档 <span class="m-icon"><i class="fas fa-chevron-right"></i></span></a><ul><li><a href="/archives" style="margin-left:75px" ;><i class="fa fa fa-tasks" style="position:absolute;left:50px"></i> <span>简约风</span></a></li><li><a href="/timeline" style="margin-left:75px" ;><i class="fa fa fa-ellipsis-v" style="position:absolute;left:50px"></i> <span>时间轴</span></a></li></ul></li><li class="m-nav-item"><a href="/data" class="waves-effect waves-light"><i class="fa-fw fa fa-list-alt"></i> 统计</a></li></ul></div></div></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/medias/featureimages/17.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">kube-apiserver审计日志记录和采集</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{height:calc(100vh - 250px);overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px}#toc-content .is-active-link{color:#42b983}#toc-content .is-active-link::before{background-color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:110px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><span class="chip bg-color">无标签</span></div></div><div class="col s5 right-align"></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp; 2022-12-07</div><div class="post-date info-break-policy"><i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp; 2022-12-07</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp; 2.5k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp; 11 分</div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><p>Kubernetes 审计功能提供了与安全相关的按时间顺序排列的记录集，记录单个用户、管理员或系统其他组件影响系统的活动顺序。它能帮助集群管理员处理以下问题：</p><ul><li>发生了什么？</li><li>什么时候发生的？</li><li>谁触发的？</li><li>为什么发生？</li><li>在哪观察到的？</li><li>它从哪触发的？</li><li>它将产生什么后果？</li></ul><p>Kube-apiserver&nbsp; 执行审计。每个执行阶段的每个请求都会生成一个事件，然后根据特定策略对事件进行预处理并写入后端。</p><p>每个请求都可以用相关的 “stage” 记录。已知的 stage 有：</p><ul><li><strong>RequestReceived&nbsp;-</strong> 事件的 stage 将在审计处理器接收到请求后，并且在委托给其余处理器之前生成。</li><li><strong>ResponseStarted&nbsp;-</strong> 在响应消息的头部发送后，但是响应消息体发送前。这个 stage 仅为长时间运行的请求生成（例如 watch）。</li><li><strong>ResponseComplete&nbsp;-</strong> 当响应消息体完成并且没有更多数据需要传输的时候。</li><li><strong>Panic&nbsp;-</strong> 当 panic 发生时生成。</li></ul><p><strong>Note:</strong></p><p>审计日志记录功能会增加 API server 的内存消耗，因为需要为每个请求存储审计所需的某些上下文。此外，内存消耗取决于审计日志记录的配置。</p><h2 id="审计策略"><a href="#审计策略" class="headerlink" title="审计策略"></a><strong>审计策略</strong></h2><p>审计政策定义了关于应记录哪些事件以及应包含哪些数据的规则。处理事件时，将按顺序与规则列表进行比较。第一个匹配规则设置事件的 [审计级别][auditing-level]。已知的审计级别有：</p><p><strong>None&nbsp;-</strong> 符合这条规则的日志将不会记录。</p><p><strong>Metadata&nbsp;-</strong> 记录请求的 metadata（请求的用户、timestamp、resource、verb 等等），但是不记录请求或者响应的消息体。</p><p><strong>Request&nbsp;-</strong> 记录事件的 metadata 和请求的消息体，但是不记录响应的消息体。这不适用于非资源类型的请求。</p><p>**RequestResponse&nbsp;-**记录事件的 metadata，请求和响应的消息体。这不适用于非资源类型的请求。</p><p>您可以使用 &nbsp;–audit-policy-file&nbsp; 标志将包含策略的文件传递给 &nbsp;kube-apiserver。如果不设置该标志，则不记录事件。注意 &nbsp;rules&nbsp; 字段必须在审计策略文件中提供。</p><p>以下是一个审计策略文件的示例：</p><p>audit/audit-policy.yaml</p><p>apiVersion:&nbsp;audit.k8s.io/v1beta1&nbsp;#&nbsp;This&nbsp;is&nbsp;required.<br>kind:&nbsp;Policy<br>#&nbsp;Don’t&nbsp;generate&nbsp;audit&nbsp;events&nbsp;for&nbsp;all&nbsp;requests&nbsp;in&nbsp;RequestReceived&nbsp;stage.<br>omitStages:<br>&nbsp;&nbsp;-&nbsp;“RequestReceived”<br>rules:<br>&nbsp;&nbsp;#&nbsp;Log&nbsp;pod&nbsp;changes&nbsp;at&nbsp;RequestResponse&nbsp;level<br>&nbsp;&nbsp;-&nbsp;level:&nbsp;RequestResponse<br>&nbsp;&nbsp;&nbsp;&nbsp;resources:<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;group:&nbsp;“”<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Resource&nbsp;“pods”&nbsp;doesn’t&nbsp;match&nbsp;requests&nbsp;to&nbsp;any&nbsp;subresource&nbsp;of&nbsp;pods,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;which&nbsp;is&nbsp;consistent&nbsp;with&nbsp;the&nbsp;RBAC&nbsp;policy.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resources:&nbsp;[“pods”]<br>&nbsp;&nbsp;#&nbsp;Log&nbsp;“pods/log”,&nbsp;“pods/status”&nbsp;at&nbsp;Metadata&nbsp;level<br>&nbsp;&nbsp;-&nbsp;level:&nbsp;Metadata<br>&nbsp;&nbsp;&nbsp;&nbsp;resources:<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;group:&nbsp;“”<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resources:&nbsp;[“pods/log”,&nbsp;“pods/status”]</p><h1 id="Don’t-log-requests-to-a-configmap-called-“controller-leader”"><a href="#Don’t-log-requests-to-a-configmap-called-“controller-leader”" class="headerlink" title="Don’t&nbsp;log&nbsp;requests&nbsp;to&nbsp;a&nbsp;configmap&nbsp;called&nbsp;“controller-leader”"></a>Don’t&nbsp;log&nbsp;requests&nbsp;to&nbsp;a&nbsp;configmap&nbsp;called&nbsp;“controller-leader”</h1><p>&nbsp;&nbsp;-&nbsp;level:&nbsp;None<br>&nbsp;&nbsp;&nbsp;&nbsp;resources:<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;group:&nbsp;“”<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resources:&nbsp;[“configmaps”]<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resourceNames:&nbsp;[“controller-leader”]</p><h1 id="Don’t-log-watch-requests-by-the-“system-kube-proxy”-on-endpoints-or-services"><a href="#Don’t-log-watch-requests-by-the-“system-kube-proxy”-on-endpoints-or-services" class="headerlink" title="Don’t&nbsp;log&nbsp;watch&nbsp;requests&nbsp;by&nbsp;the&nbsp;“system:kube-proxy”&nbsp;on&nbsp;endpoints&nbsp;or&nbsp;services"></a>Don’t&nbsp;log&nbsp;watch&nbsp;requests&nbsp;by&nbsp;the&nbsp;“system:kube-proxy”&nbsp;on&nbsp;endpoints&nbsp;or&nbsp;services</h1><p>&nbsp;&nbsp;-&nbsp;level:&nbsp;None<br>&nbsp;&nbsp;&nbsp;&nbsp;users:&nbsp;[“system:kube-proxy”]<br>&nbsp;&nbsp;&nbsp;&nbsp;verbs:&nbsp;[“watch”]<br>&nbsp;&nbsp;&nbsp;&nbsp;resources:<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;group:&nbsp;“”&nbsp;#&nbsp;core&nbsp;API&nbsp;group<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resources:&nbsp;[“endpoints”,&nbsp;“services”]</p><h1 id="Don’t-log-authenticated-requests-to-certain-non-resource-URL-paths"><a href="#Don’t-log-authenticated-requests-to-certain-non-resource-URL-paths" class="headerlink" title="Don’t&nbsp;log&nbsp;authenticated&nbsp;requests&nbsp;to&nbsp;certain&nbsp;non-resource&nbsp;URL&nbsp;paths."></a>Don’t&nbsp;log&nbsp;authenticated&nbsp;requests&nbsp;to&nbsp;certain&nbsp;non-resource&nbsp;URL&nbsp;paths.</h1><p>&nbsp;&nbsp;-&nbsp;level:&nbsp;None<br>&nbsp;&nbsp;&nbsp;&nbsp;userGroups:&nbsp;[“system:authenticated”]<br>&nbsp;&nbsp;&nbsp;&nbsp;nonResourceURLs:<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;“/api*“&nbsp;#&nbsp;Wildcard&nbsp;matching.<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;“/version”</p><h1 id="Log-the-request-body-of-configmap-changes-in-kube-system"><a href="#Log-the-request-body-of-configmap-changes-in-kube-system" class="headerlink" title="Log&nbsp;the&nbsp;request&nbsp;body&nbsp;of&nbsp;configmap&nbsp;changes&nbsp;in&nbsp;kube-system."></a>Log&nbsp;the&nbsp;request&nbsp;body&nbsp;of&nbsp;configmap&nbsp;changes&nbsp;in&nbsp;kube-system.</h1><p>&nbsp;&nbsp;-&nbsp;level:&nbsp;Request<br>&nbsp;&nbsp;&nbsp;&nbsp;resources:<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;group:&nbsp;“”&nbsp;#&nbsp;core&nbsp;API&nbsp;group<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resources:&nbsp;[“configmaps”]<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;rule&nbsp;only&nbsp;applies&nbsp;to&nbsp;resources&nbsp;in&nbsp;the&nbsp;“kube-system”&nbsp;namespace.<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;empty&nbsp;string&nbsp;“”&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;select&nbsp;non-namespaced&nbsp;resources.<br>&nbsp;&nbsp;&nbsp;&nbsp;namespaces:&nbsp;[“kube-system”]</p><h1 id="Log-configmap-and-secret-changes-in-all-other-namespaces-at-the-Metadata-level"><a href="#Log-configmap-and-secret-changes-in-all-other-namespaces-at-the-Metadata-level" class="headerlink" title="Log&nbsp;configmap&nbsp;and&nbsp;secret&nbsp;changes&nbsp;in&nbsp;all&nbsp;other&nbsp;namespaces&nbsp;at&nbsp;the&nbsp;Metadata&nbsp;level."></a>Log&nbsp;configmap&nbsp;and&nbsp;secret&nbsp;changes&nbsp;in&nbsp;all&nbsp;other&nbsp;namespaces&nbsp;at&nbsp;the&nbsp;Metadata&nbsp;level.</h1><p>&nbsp;&nbsp;-&nbsp;level:&nbsp;Metadata<br>&nbsp;&nbsp;&nbsp;&nbsp;resources:<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;group:&nbsp;“”&nbsp;#&nbsp;core&nbsp;API&nbsp;group<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resources:&nbsp;[“secrets”,&nbsp;“configmaps”]</p><h1 id="Log-all-other-resources-in-core-and-extensions-at-the-Request-level"><a href="#Log-all-other-resources-in-core-and-extensions-at-the-Request-level" class="headerlink" title="Log&nbsp;all&nbsp;other&nbsp;resources&nbsp;in&nbsp;core&nbsp;and&nbsp;extensions&nbsp;at&nbsp;the&nbsp;Request&nbsp;level."></a>Log&nbsp;all&nbsp;other&nbsp;resources&nbsp;in&nbsp;core&nbsp;and&nbsp;extensions&nbsp;at&nbsp;the&nbsp;Request&nbsp;level.</h1><p>&nbsp;&nbsp;-&nbsp;level:&nbsp;Request<br>&nbsp;&nbsp;&nbsp;&nbsp;resources:<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;group:&nbsp;“”&nbsp;#&nbsp;core&nbsp;API&nbsp;group<br>&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;group:&nbsp;“extensions”&nbsp;#&nbsp;Version&nbsp;of&nbsp;group&nbsp;should&nbsp;NOT&nbsp;be&nbsp;included.</p><h1 id="A-catch-all-rule-to-log-all-other-requests-at-the-Metadata-level"><a href="#A-catch-all-rule-to-log-all-other-requests-at-the-Metadata-level" class="headerlink" title="A&nbsp;catch-all&nbsp;rule&nbsp;to&nbsp;log&nbsp;all&nbsp;other&nbsp;requests&nbsp;at&nbsp;the&nbsp;Metadata&nbsp;level."></a>A&nbsp;catch-all&nbsp;rule&nbsp;to&nbsp;log&nbsp;all&nbsp;other&nbsp;requests&nbsp;at&nbsp;the&nbsp;Metadata&nbsp;level.</h1><p>&nbsp;&nbsp;-&nbsp;level:&nbsp;Metadata<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Long-running&nbsp;requests&nbsp;like&nbsp;watches&nbsp;that&nbsp;fall&nbsp;under&nbsp;this&nbsp;rule&nbsp;will&nbsp;not<br>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;generate&nbsp;an&nbsp;audit&nbsp;event&nbsp;in&nbsp;RequestReceived.<br>&nbsp;&nbsp;&nbsp;&nbsp;omitStages:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;“RequestReceived”</p><p>也可以使用最低限度的审计策略文件在 &nbsp;Metadata&nbsp; 级别记录所有请求：</p><h1 id="Log-all-requests-at-the-Metadata-level"><a href="#Log-all-requests-at-the-Metadata-level" class="headerlink" title="Log&nbsp;all&nbsp;requests&nbsp;at&nbsp;the&nbsp;Metadata&nbsp;level."></a>Log&nbsp;all&nbsp;requests&nbsp;at&nbsp;the&nbsp;Metadata&nbsp;level.</h1><p>apiVersion:&nbsp;audit.k8s.io/v1beta1<br>kind:&nbsp;Policy<br>rules:<br>-&nbsp;level:&nbsp;Metadata</p><p><strong>审计日志后端：</strong></p><p>k8s 目前提供两种日志后端，Log 后端和 webhook 后端，Log 后端可以将日志输出到文件，webhook 后端将日志发送到远端日志服务器，接下来暂且只对 Log 后端日志的记录配置和采集做一下实践。</p><p><strong>以下实践组件版本 docker ce17，k8s 1.9.2</strong></p><p>可以使用以下 &nbsp;kube-apiserver&nbsp; 标志配置 Log 审计后端：</p><p><strong>--audit-log-path</strong>指定用来写入审计事件的日志文件路径。不指定此标志会禁用日志后端。-&nbsp; 意味着标准化</p><p><strong>--audit-log-maxage</strong>定义了保留旧审计日志文件的最大天数</p><p><strong>--audit-log-maxbackup</strong>定义了要保留的审计日志文件的最大数量</p><p><strong>--audit-log-maxsize</strong>定义审计日志文件的最大大小（兆字节）</p><p>我司目前集群中 kube-apiserver 组件作为 static pod 方式运行，生命周期由 kubelet 直接管理，static pod 由 kebelet 根据 yaml 文件创建，yaml 存放路径为/etc/kubernetes/manifests/目录，其中 apiserver 由 kubelet 根据 kube-apiserver.yaml 创建，Log 后端需要在 kube-apiserver.yaml 的启动参数里加以下参数：</p><p>--feature-gates=AdvancedAuditing=true</p><p>--audit-policy-file=/etc/kubernetes/pki/audit-policy.yaml</p><p>--audit-log-format=json</p><p>--audit-log-path=/var/log/kubernetes/kubernetes-audit</p><p>--audit-log-maxage=30</p><p>--audit-log-maxbackup=3</p><p>--audit-log-maxsize=100</p><p><strong>说明：</strong></p><ul><li>AdvancedAuditing 指明启用高级审计功能，即：可以使–audit-policy-file 参数指定审计策略，该参数从 k8s 1.8 版本以后默认为 true；</li><li>audit-policy-file 指定策略文件的位置，该路径为 kube-apiserver 容器内的路径，所以得从宿主机挂载策略文件到容器内，故暂且放在/etc/kubernetes/pki/目录下；</li><li>audit-log-format 指定最终审计日志的格式为 json，该参数默认为 json；</li><li>audit-log-path 指定最终审计日志存放在容器内的位置，该位置会自动创建。上述表示最终的审计日志文件为 kubernetes-audit</li></ul><p><strong>最终配置如下：</strong></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuBvfDEibQAG8icuU2WXEcDyG6fibnnouDXdeO5HtNoOYZ7iaSOKAtP1vKZA/640?wx_fmt=png"></p><p>修改完成后，kubelet 会自动删除重建 kube-apiserver 的 pod（如果 pod 被删除后，过几分钟还不被创建，可以修改–audit-log-maxbackup 的值保存退出，等待 pod 被创建—这可能是一个 bug），重启状态变为 running 后可以进入容器查看生成的审计日志文件：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuU4hzvlaGicMBcboepUEmq0IA15AlIZtNCVu57Yn86ULN4Ie9kL8825A/640?wx_fmt=png"></p><p>查看该日志：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuT9AYANIEbqQtjGzurfhLe0R3p9AW9APqkPUweib5rmMe7SRiaXM3M5kw/640?wx_fmt=png"></p><p>达到 100M 后：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuXGIbEdKgNuts9memqXVibQzdKrM5889fGqzwxncBpK6PrfO7KUn89qw/640?wx_fmt=png"></p><p>因为后面要用 fluentd 作为 agent 去采集该日志，所以需要把容器内的日志挂载到宿主机目录下，修改 kube-apiserver.yaml 如下，即将容器内/var/log/kubernetes 目录挂载到宿主机的/var/log/kubernetes 目录。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZu4F3cmLQn4sarGE6p2cHiaezQkjHXP73DKQBbctVUE0kdvf3RK3lDPXw/640?wx_fmt=png"></p><h4 id="日志采集"><a href="#日志采集" class="headerlink" title="日志采集"></a><strong>日志采集</strong></h4><p>目前集群中已部署了 fluentd+elasticsearch 日志方案，所以选用 fluentd 作为 Logging-agent ，Elasticsearch 作为 &nbsp; Logging Backend 。集群中的 fluentd-es 作为 DaemonSet 方式运行，根据 DaemonSet 的特性，应该在每个 Node 上都会运行 fluentd-es 的 pod，但实际情况是 19 环境上 3 个 master 节点都没有该 pod。查看名为 fluentd-es-v1.22 的 DaemonSet yaml 可以发现，pod 只会运行在有 alpha.kubernetes.io/fluentd-ds-ready: “true”标签的 node 上：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuyF1a5lEaBEjXpzFNJSLeMkIEic0UOiaJ9GhEtylhpqiccibYp7vHa9ib9lw/640?wx_fmt=png"></p><p>查看 master 节点的 node yaml，发现确实没有该标签。故需要在 master 节点 node 上添加该标签：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuYibN13sxjmLBnkJ3aibzAYicL0U0Nen2zbVRymxXWHvbEg2DoV0HmhwjQ/640?wx_fmt=png"></p><p>添加完 label 后，可以看到在 docker-vm-6 节点上 pod 会被自动创建。</p><p>Fluentd 的配置文件在容器内的/etc/td-agent/td-agent.conf 中配置，部分配置截图如下：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuvhC97lBplUkpYItHzmGywQMsAPJXDDQfazXbxR5YuVKuU8OzOKhibDQ/640?wx_fmt=png"></p><p>该配置由名为 fluentd 的 ConfigMap 指定：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuBr0mictkMbbicP3TrQiase50JPDbcia2uDxZIP19ElibFgKyZKPvTVfMtLg/640?wx_fmt=png"></p><p>可以看到配置里并不会去采集、转发审计日志/var/log/kubernetes/kubernetes-audit，所以需要在该 ConfigMap 中添加以下配置：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuJHXzCDia8PbQib04o9TvSWxzFqHnVslXfibLnL3f7wgtyB9ibJDDTPydvg/640?wx_fmt=png"></p><p>添加后的截图如下：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuD9cVGib6sWeIvvicaibqP5eJcKicJ6s79ibHrL55p76kSJF0xTNCOv4WC8A/640?wx_fmt=png"></p><p>之后需要重启一下 kube-apiserver 节点的 fluentd pod，fluentd 采集时，也会输出日志到宿主机的/var/log/fluentd.log 里，可以看到错误日志等信息，用于定位问题。如果该文件没有审计日志相关错误，日志应该就会被发送到 logging-backend：elasticsearch，可以用以下命令验证：</p><ul><li>先查看 elasticsearch 的 service IP 和 Port，然后用 curl 命令调用 rest 接口查询当前集群中所有 index 信息：</li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZurCwar7Tp611Jvqgen0LH9cW6tqtHcN5iaBblwVvJ33EibsqyfXZGnXDA/640?wx_fmt=png"></p><ul><li>查询到审计日志信息如下，大概有 220 万条记录：</li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZuG8AkpcrsQh5q0cMRtygLgHVbRvvdqB28NsTibIibd6pEu0cA09x1UwZg/640?wx_fmt=png"></p><p>详细信息如下，和审计日志文件中记录的一样：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/gIkzzLe4eUXibIamwUnmDhNcxiaicia4BcZun8MeuNZAiaax6MKpGKBFnTCicr1qCU4XGHNaZD3B5t7jgib97e1fkibemw/640?wx_fmt=png"></p><p>后续可以用 Kibana 进行日志展示，Elasticsearch、Fluentd、Kibana 即为大名鼎鼎的 EFK 日志收集方案，还有 ELK 等，可以根据项目的需求选择适当的组件。</p></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者: &nbsp; </i></span><span class="reprint-info"><a href="https://jlovec.net" rel="external nofollow noreferrer">Joey Wang</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接: &nbsp; </i></span><span class="reprint-info"><a href="https://jlovec.net/2022/12/07/kube-apiserver-shen-ji-ri-zhi-ji-lu-he-cai-ji/">https://jlovec.net/2022/12/07/kube-apiserver-shen-ji-ri-zhi-ji-lu-he-cai-ji/</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明: &nbsp; </i></span><span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="https://jlovec.net" target="_blank">Joey Wang</a> !</span></div></div><script async defer>function navToReprintStatement(){$("html, body").animate({scrollTop:$("#reprint-statement").offset().top-80},800)}document.addEventListener("copy",function(t){M.toast({html:'<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>'})})</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><span class="chip bg-color">无标签</span></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="qq,weibo,douban,google,wechat" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/medias/reward/alipay.jpeg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/medias/reward/wechat.jpeg" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="far fa-dot-circle"></i>&nbsp;本篇</div><div class="card"><a href="/2022/12/07/kube-apiserver-shen-ji-ri-zhi-ji-lu-he-cai-ji/"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/medias/featureimages/17.jpg" class="responsive-img" alt="kube-apiserver审计日志记录和采集"> <span class="card-title">kube-apiserver审计日志记录和采集</span></div></a><div class="card-content article-content"><div class="summary block-with-text">Kubernetes 审计功能提供了与安全相关的按时间顺序排列的记录集，记录单个用户、管理员或系统其他组件影响系统的活动顺序。它能帮助集群管理员处理以下问题： 发生了什么？ 什么时候发生的？ 谁触发的？ 为什么发生？ 在哪观察到的？ 它从</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2022-12-07 </span><span class="publish-author"><i class="fas fa-user fa-fw"></i> Joey Wang</span></div></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/2021/09/03/running-spring-boot-apps-as-graalvm-native-images-codecentric-ag-blog/"><div class="card-image"><img src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/medias/featureimages/3.jpg" class="responsive-img" alt="Running Spring Boot apps as GraalVM Native Images - codecentric AG Blog"> <span class="card-title">Running Spring Boot apps as GraalVM Native Images - codecentric AG Blog</span></div></a><div class="card-content article-content"><div class="summary block-with-text">All those Micronaut, Quarkus.io &amp; Co. frameworks sound great! But Spring is the undisputed forerunner in Enterprise</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i>2021-09-03 </span><span class="publish-author"><i class="fas fa-user fa-fw"></i> Joey Wang</span></div></div></div></div></div></article></div><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/codeBlock/codeBlockFuction.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/codeBlock/codeLang.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/codeBlock/codeCopy.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/codeBlock/codeShrink.js"></script><style type="text/css">code[class*=language-],pre[class*=language-]{white-space:pre!important}</style></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/tocbot/tocbot.min.js"></script><script>$(function(){tocbot.init({tocSelector:"#toc-content",contentSelector:"#articleContent",headingsOffset:-(.4*$(window).height()-45),collapseDepth:Number("0"),headingSelector:"h1, h2, h3, h4"});let t=0,e="toc-heading-",n=($("#toc-content a").each(function(){$(this).attr("href","#"+e+ ++t)}),t=0,$("#articleContent").children("h1, h2, h3, h4").each(function(){$(this).attr("id",e+ ++t)}),parseInt(.4*$(window).height()-64)),o=$(".toc-widget");$(window).scroll(function(){$(window).scrollTop()>n?o.addClass("toc-fixed"):o.removeClass("toc-fixed")});const i="expanded";let c=$("#toc-aside"),a=$("#main-content");$("#floating-toc-btn .btn-floating").click(function(){c.hasClass(i)?(c.removeClass(i).hide(),a.removeClass("l9")):(c.addClass(i).show(),a.addClass("l9"));var e="artDetail",n="prenext-posts";if(0!==(e=$("#"+e)).length){let t=e.width();450<=t?t+=21:350<=t&&t<450?t+=18:300<=t&&t<350?t+=16:t+=14,$("#"+n).width(t)}})})</script></main><footer class="page-footer bg-color"><div class="container row center-align" style="margin-bottom:15px!important"><div class="col s12 m8 l8 copy-right">Design by&nbsp;<a href="https://blog.csdn.net/z_johnny" target="_blank">Joey Wang</a> &nbsp|&nbsp&nbsp;Powered by&nbsp;<a href="https://github.com/hongweifuture/hexo-theme-halo" target="_blank">Halo</a> of <a href="https://hexo.io/" target="_blank">Hexo</a><br>&nbsp;<i class="fas fa-chart-area"></i>&nbsp;总字数:&nbsp;<span class="white-color">26.7k</span>&nbsp;字 <span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次 </span><span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;点击量:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;次</span><br>Copyright&nbsp;&copy; <span id="year">2020</span>&nbsp&nbsp| &nbsp;<a href="https://jlovec.net/sitemap.xml" target="_blank">Sitemap</a>&nbsp;&nbsp;|&nbsp; <span id="sitetime">载入运行时间...</span><script>function siteTime(){var e=36e5,t=24*e,o=new Date,n="2020",a=o.getFullYear(),r=o.getMonth()+1,i=o.getDate(),l=o.getHours(),M=o.getMinutes(),o=o.getSeconds(),g=Date.UTC(n,"11","20","0","0","0"),r=Date.UTC(a,r,i,l,M,o)-g,i=Math.floor(r/31536e6),l=Math.floor(r/t-365*i),M=Math.floor((r-(365*i+l)*t)/e),o=Math.floor((r-(365*i+l)*t-M*e)/6e4);Math.floor((r-(365*i+l)*t-M*e-6e4*o)/1e3);document.getElementById("year").innerHTML=n==a?a:n+" - "+a,document.getElementById("sitetime").innerHTML="本站已充电 "+i+" 年 "+l+" 天 "}setInterval(siteTime,1e3)</script><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/jlovec1024" class="tooltipped" target="_blank" data-toggle="tooltip" data-placement="top" title="访问我的GitHub"><i class="fab fa-github"></i> </a><a href="mailto:jlovec1024@163.com" class="tooltipped" target="_blank" data-toggle="tooltip" data-placement="top" title="邮件联系我"><i class="fas fa-envelope-open"></i> </a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=461285930" class="tooltipped" target="_blank" data-toggle="tooltip" data-placement="top" title="QQ 联系我: 461285930"><i class="fab fa-qq"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/js/search.js"></script><script type="text/javascript">$(function(){searchFunc("https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/materialize/materialize.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/masonry/masonry.pkgd.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/aos/aos.js"></script><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/scrollprogress/scrollProgress.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/js/matery.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0],e=(t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",document.getElementsByTagName("script")[0]);e.parentNode.insertBefore(t,e)}()</script><script async src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/others/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/gh/jlovec1024/jlovec1024.github.io/libs/instantpage/instantpage.js" type="module"></script><script type="text/javascript">var st,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="Jlovec",clearTimeout(st)):(document.title="Jlovec",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script><div id="he-plugin-simple"></div><script>WIDGET={CONFIG:{modules:"01234",background:5,tmpColor:"FFFFFF",tmpSize:16,cityColor:"FFFFFF",citySize:"16",aqiSize:16,weatherIconSize:"20",alertIconSize:18,padding:"10px 10px 10px 10px",shadow:"0",language:"auto",fixed:"true",vertical:"top",horizontal:"right",right:10,top:"60",key:"2ccd90212a1d41dea248662765a0fb9c"}}</script><script src="https://widget.heweather.net/simple/static/js/he-simple-common.js?v=1.1"></script><script src="//cdn.jsdelivr.net/npm/js-base64/base64.min.js"></script><script>const hasAttr=(e,t)=>t.some(t=>void 0!==e.attr(t));$("a").each(function(){var t,e,r=$(this);hasAttr(r,["data-fancybox","ignore-external-link"])||(t=r.attr("href"))&&t.match("^((http|https|thunder|qqdl|ed2k|Flashget|qbrowser|ftp|rtsp|mms)://)")&&3<=(e=t.split("/")).length&&("jlovec.net"===e[2]&&!window.location.host||(r.attr("href","/go.html?u="+Base64.encode(t)).attr("rel","external nofollow noopener noreferrer"),r.attr("target","_blank")))})</script></body></html>